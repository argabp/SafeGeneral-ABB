@using Kendo.Mvc.UI
@using Kendo.Mvc.TagHelpers
@using Microsoft.Extensions.Configuration
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
@addTagHelper *, Kendo.Mvc

@{
    Layout = "~/Modules/Shared/_Layout.cshtml";
    ViewData["Title"] = "Laporan Buku Besar 117";
}

<style>
    body {
        font-family: "Times New Roman", Times, serif;
    }

    .filter-container {
        padding: 10px 15px;
    }

    .filter-section {
        display: flex;
        align-items: center;
        margin-bottom: 10px;
    }

    .filter-label {
        width: 150px;
        min-width: 150px;
        font-weight: 600;
        white-space: nowrap;
    }

    .filter-input-group {
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .sd-text {
        font-weight: 600;
        margin: 0 6px;
    }

    .k-textbox[readonly] {
        background-color: #f2f2f2;
    }

    .btn-area {
        margin-top: 10px;
        padding-left: 150px;
    }
</style>

<div class="flat-box filter-box">
    <div class="flat-box-content filter-container">

        <!-- KODE CABANG -->
        <div class="filter-section">
            <label class="filter-label">Kode Cabang</label>
            <input class="k-textbox"
                   value="@ViewBag.UserCabangText"
                   readonly
                   style="width:300px;" />
            <input type="hidden" id="KodeCabang" value="@ViewBag.UserCabangValue" />
        </div>

        <!-- PERIODE -->
        <div class="filter-section">
            <label class="filter-label">Periode</label>
            <div class="filter-input-group">
                @(Html.Kendo().DatePicker()
                    .Name("tgl1")
                    .Format("dd-MM-yyyy")
                    .HtmlAttributes(new { style = "width:120px;" }))
                <span class="sd-text">s/d</span>
                @(Html.Kendo().DatePicker()
                    .Name("tgl2")
                    .Format("dd-MM-yyyy")
                    .HtmlAttributes(new { style = "width:120px;" }))
            </div>
        </div>

        <!-- KODE AKUN -->
        <div class="filter-section">
            <label class="filter-label">Kode Akun 104</label>
            <div class="filter-input-group">
                @(Html.Kendo().ComboBox()
                    .Name("AkunAwal")
                    .Placeholder("Dari Akun...")
                    .DataTextField("Display")
                    .DataValueField("Kode")
                    .Filter("contains")
                    .Suggest(true)
                    .HtmlAttributes(new { style = "width:250px;" })
                    .DataSource(source =>
                    {
                        source.Read(read =>
                        {
                            read.Action("GetCoaList", "LaporanBukuBesar117");
                        });
                    })
                )

                <span class="sd-text">s/d</span>

                @(Html.Kendo().ComboBox()
                    .Name("AkunAkhir")
                    .Placeholder("Sampai Akun...")
                    .DataTextField("Display")
                    .DataValueField("Kode")
                    .Filter("contains")
                    .Suggest(true)
                    .HtmlAttributes(new { style = "width:250px;" })
                    .DataSource(source =>
                    {
                        source.Read(read =>
                        {
                            read.Action("GetCoaList", "LaporanBukuBesar117");
                        });
                    })
                )
            </div>
        </div>

        <!-- BUTTON -->
        <div class="btn-area">
            <button id="btnSearch"
                    class="k-button k-primary"
                    style="width:120px;"
                    onclick="generateBukuBesar117()">
                <span class="k-icon k-i-print"></span>
                Cetak
            </button>
        </div>

    </div>
</div>

<script>
    function generateBukuBesar117() {
        var kodeCabang = $("#KodeCabang").val();
        var tgl1 = kendo.toString($("#tgl1").data("kendoDatePicker").value(), "yyyy-MM-dd");
        var tgl2 = kendo.toString($("#tgl2").data("kendoDatePicker").value(), "yyyy-MM-dd");
        var akun1 = $("#AkunAwal").data("kendoComboBox").value();
        var akun2 = $("#AkunAkhir").data("kendoComboBox").value();

        if (!tgl1 || !tgl2) {
            alert("Periode tanggal harus diisi!");
            return;
        }

        var payload = {
            KodeCabang: kodeCabang,
            PeriodeAwal: tgl1,
            PeriodeAkhir: tgl2,
            AkunAwal: akun1,
            AkunAkhir: akun2
        };

        $.ajax({
            url: '/LaporanBukuBesar117/GenerateReport',
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify(payload),
            success: function (res) {
                if (res.Status === "OK") {
                    window.open("/Reports/" + res.Data + "/LaporanBukuBesar117.pdf", "_blank");
                } else {
                    alert("Error: " + res.Message);
                }
            },
            error: function () {
                alert("Terjadi kesalahan server");
            }
        });
    }
</script>
