@using Kendo.Mvc.UI
@using Kendo.Mvc.TagHelpers
@using ABB.Application.InquiryNotaProduksis.Queries
@using Microsoft.Extensions.Configuration
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
@addTagHelper *, Kendo.Mvc

@inject IConfiguration Configuration

@{
    Layout = "~/Modules/Shared/_Layout.cshtml";
    ViewData["Title"] = "Inquiry Nota";
}

<script src="~/Modules/InquiryNotaProduksi/JS/InquiryNotaProduksi.index.js"></script>

<style>
    .div-box{
        padding-bottom: 1em;
    }
      .breadcrumb-item + .breadcrumb-item::before {
        content: ">"; /* Ganti '/' dengan '>' */
        padding: 0 .5rem; /* Atur spasi jika perlu */
    }
</style>
<nav  aria-label="breadcrumb">
   <ol class="breadcrumb" style="background: white; ">
        <li class="breadcrumb-item"><a href="#">Finance</a></li>
        <li class="breadcrumb-item active" aria-current="page">Inquiry Nota</li>
    </ol>
    </nav>
<div class="flat-box filter-box">
    <div class="flat-box-content">
        <div class="filter-bar" style="display:flex; align-items:center; gap:10px; flex-wrap:wrap;">

            <!-- Label Periode -->
            <label for="StartDate"><b>Periode :</b></label>

            <!-- DatePicker Dari -->
            @(Html.Kendo().DatePicker()
                .Name("StartDate")
                .HtmlAttributes(new { style = "width:150px;" })
                .Format("dd-MM-yyyy")
            )

            <span class="date-separator">s/d</span>

            <!-- DatePicker Sampai -->
            @(Html.Kendo().DatePicker()
                .Name("EndDate")
                .HtmlAttributes(new { style = "width:150px;" })
                .Format("dd-MM-yyyy")
            )

            <!-- Label Jenis Asset -->
            <label for="JenisAsset" style="margin-left:15px;"><b>Jenis Ass :</b></label>

            <!-- Dropdown Jenis Asset -->
            @(Html.Kendo().ComboBox()
                .Name("JenisAsset")
                .Placeholder("Pilih ...")
                .DataTextField("NamaJenisAsset")
                .DataValueField("KodeJenisAsset")
                .Filter("contains") // bisa mengetik untuk filter
                .Suggest(true) // auto-suggest saat ketik
                .DataSource(source => {
                    source.Read(read => {
                        read.Action("GetJenisAssetList", "InquiryNotaProduksi");
                    });
                })
                .HtmlAttributes(new { style = "width:250px;" })
            )


            <!-- Tombol Cari -->
            @(Html.Kendo().Button()
                .Name("btnSearch")
                .Content("<span class='k-icon k-i-search'></span> Cari")
                .HtmlAttributes(new { @class = "k-primary", style = "border-radius:6px; margin-left:10px;" })
                .Events(e => e.Click("onSearchClick"))
            )
        </div>
    </div>
</div>


<div class="flat-box">
        <div class="flat-box-title ">
            Inquiry Nota
            <div class="pullright-flex">
            <input type="text" class="search-field-top " id="SearchKeyword" placeholder="Search"/>
        
      
            <!-- <button class="flat-btn-primary" onclick="btnAddVoucherKas_OnClick()">Entri Voucher Kas</button> -->
        </div>
    </div>

    <div class="flat-box-content">
        <div class="div-box">
             @(Html.Kendo().Grid<InquiryNotaProduksiDto>()
                .Name("InquiryNotaProduksiGrid")
                .NoRecords(n => n.Template("<div style='padding:5px;'>Data tidak ditemukan</div>"))
                .AutoBind(false)  
                .DataSource(dataSource => dataSource.Ajax()
                           .Read(read => read.Action("GetInquiryNotaProduksi", "InquiryNotaProduksi").Data("getAllFilters"))
                           .Model(model => model.Id(p => p.id))
                           .PageSize(20) // Tambahkan PageSize biar rapi
                )
                .Columns(columns =>
                {
                    
                    // 1. Lokasi (lok)
                    columns.Bound(col => col.lok).Width(80).Title("Lokasi")
                           .HtmlAttributes(new { style = "text-align:center" });

                    // 2. Tipe (type)
                    columns.Bound(col => col.type).Width(80).Title("Tipe")
                           .HtmlAttributes(new { style = "text-align:center" });

                    // 3. Jenis Asuransi (jn_ass)
                    columns.Bound(col => col.jn_ass).Width(100).Title("Jenis Ass");

                    // 4. No Referensi (no_ref)
                    columns.Bound(col => col.no_ref).Width(180).Title("No. Referensi");

                    // 5. No Nota (no_nd)
                    columns.Bound(col => col.no_nd).Width(180).Title("No. Nota");

                    columns.Bound(col => col.date_input)
                           .Width(120) // Lebar dikecilkan biar pas
                           .Title("Tanggal Nota")
                           .Format("{0:dd-MM-yyyy}") // <--- INI KUNCINYA (Format Aesthetic)
                           .HtmlAttributes(new { style = "text-align:center" });

                    // 6. No Polis (no_pl)
                    columns.Bound(col => col.no_pl).Width(250).Title("No. Polis");

                    // 7. Customer (nm_cust)
                    columns.Bound(col => col.nm_cust).Width(250).Title("Customer");

                    // 8. Customer 2 (nm_cust2)
                    columns.Bound(col => col.nm_cust2).Width(250).Title("Customer 2");

                    // 9. D/K (d_k) - Rata Tengah
                    columns.Bound(col => col.d_k).Width(100).Title("D/K")
                           .HtmlAttributes(new { style = "text-align:center; font-weight:bold;" });

                    // 10. Nilai Nota (netto) - Format Angka & Rata Kanan
                    columns.Bound(col => col.netto)
                           .Width(150)
                           .Title("Nilai Nota")
                           .Format("{0:n2}") // Format desimal (1,000.00)
                           .HtmlAttributes(new { style = "text-align:right" });

                    columns.Bound(col => col.jumlah)
                        .Width(150)
                        .Title("Nilai Bayar")
                        .Format("{0:n2}") // Format desimal (1,000.00)
                        .HtmlAttributes(new { style = "text-align:right" });

                    columns.Bound(col => col.saldo)
                        .Width(150)
                        .Title("Saldo")
                        .Format("{0:n2}") // Format desimal (1,000.00)
                        .HtmlAttributes(new { style = "text-align:right" });

                    // Action Button (Locked)
                    columns.Command(command =>
                    {
                         command.Custom("LihatInquiryNotaProduksi")
                           .Text("Detail") // Kosongkan text biar cuma icon (opsional)
                         //  .IconClass("fa fa-eye")
                           .Click("btnViewInquiryNota_OnClick")
                           .HtmlAttributes(new { title = "View Detail" });
                        command.Custom("PembayaranInquiryNotaProduksi")
                           .Text("Pembayaran") // Kosongkan text biar cuma icon (opsional)
                         //  .IconClass("fa fa-eye")
                           .Click("btnPembayaranInquiryNota_OnClick")
                           .HtmlAttributes(new { title = "View Detail" });

                        command.Custom("KeteranganInquiryNotaProduksi")
                           .Text("Keterangan") // Kosongkan text biar cuma icon (opsional)
                         //  .IconClass("fa fa-eye")
                           .Click("btnKeteranganInquiryNota_OnClick")
                           .HtmlAttributes(new { title = "View Detail" });
                    }).Width(200).Title("Aksi").Locked(true);
                })
                .Pageable(pager => pager.Refresh(true).Info(true).PageSizes(new[] { 20, 50, 100 }))
                .Sortable()
                .Filterable()
                .Scrollable()
                .Height(500) // Sedikit ditinggikan
                .Resizable(a => a.Columns(true))
            )
        </div>

        @(Html.Kendo().Window()
            .Name("InquiryNotaProduksiWindow")
            .Title("Inquiry Nota")
            .Width(1000)
            .Modal(true)
            .Visible(false)
            .Draggable(true)
        )

        @(Html.Kendo().Window()
            .Name("InquiryNotaProduksiPembayaranWindow")
            .Title("Inquiry Nota")
            .Width(1000)
            .Modal(true)
            .Visible(false)
            .Draggable(true)
        )

        @(Html.Kendo().Window()
            .Name("InquiryNotaProduksiKeterangannWindow")
            .Title("Inquiry Nota")
            .Width(800)
            .Modal(true)
            .Visible(false)
            .Draggable(true)
        )

    </div>
</div>

