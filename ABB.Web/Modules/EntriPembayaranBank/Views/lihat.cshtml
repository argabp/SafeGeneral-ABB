@model ABB.Web.Modules.EntriPembayaranBank.Models.EntriPembayaranBankViewModel
@using ABB.Application.EntriPembayaranBanks.Queries
@using Kendo.Mvc.UI
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
@addTagHelper *, Kendo.Mvc

<div class="window-body">
<input type="hidden" id="VoucherDKFinal" value="@Model.VoucherHeader.DebetKredit" />
<input type="hidden" id="NoVoucherFinal" value="@Model.VoucherHeader.NoVoucher" />
<input type="hidden" id= "TangVocFinal" value="@Model.VoucherHeader.TanggalVoucher" style="font-size: 12px;"/>
    <fieldset>
    <div class="form-group row">
        <label class="col-sm-2 col-form-label">Kode Cabang</label>
        <div class="col-sm-4">
            <input class="form-control form-control-sm"
                   value="@Model.VoucherHeader.KodeCabang"
                   readonly style="font-size: 12px;"/>
        </div>
    </div>

    <div class="form-group row">
        <label class="col-sm-2 col-form-label">Jenis Voucher</label>
        <div class="col-sm-2">
            <input class="form-control form-control-sm"
                value="@Model.VoucherHeader.JenisVoucher"
                readonly style="font-size: 12px;"/>
        </div>

    
        <div class="col-sm-2">
            <input class="form-control form-control-sm"
                 value="@(Model.VoucherHeader.DebetKredit == "D" ? "Debit" : 
                                Model.VoucherHeader.DebetKredit == "K" ? "Kredit" : Model.VoucherHeader.DebetKredit)" 
                readonly style="font-size: 12px;"/>
        </div>
    </div>



    <div class="form-group row">
        
    </div>

    <div class="form-group row">
        <label class="col-sm-2 col-form-label">No Voucher</label>
        <div class="col-sm-4">
            <input class="form-control form-control-sm"
                
                   value="@Model.VoucherHeader.NoVoucher"
                   readonly style="font-size: 12px;"/>
        </div>
    </div>

    <hr>

    <div class="form-group row">
        <label class="col-sm-2 col-form-label">Dibayar Kepada</label>
        <div class="col-sm-4">
            <input class="form-control form-control-sm"
                   value="@Model.VoucherHeader.DiterimaDari"
                   readonly style="font-size: 12px;"/>
        </div>
    </div>

    <div class="form-group row">
        <label class="col-sm-2 col-form-label">Tanggal Voucher</label>
        <div class="col-sm-4">
            <input class="form-control form-control-sm"
                   value="@Model.VoucherHeader.TanggalVoucher?.ToString("dd MMM yyyy")"
                   readonly style="font-size: 12px;"/>
        </div>
    </div>

    <div class="form-group row">
        <!-- Total Voucher -->
        <label class="col-sm-2 col-form-label">Total Voucher</label>
        <div class="col-sm-4">
            <input class="form-control form-control-sm" id="TotalVoucher"
                  value="@Model.VoucherHeader.TotalVoucher?.ToString("N2")" 
                readonly style="font-size: 12px;"/>
        </div>

        <!-- Total dlm Rupiah -->
        <label class="col-sm-2 col-form-label">Total dlm Rupiah</label>
        <div class="col-sm-3">
            <input class="form-control form-control-sm"
                value="@Model.VoucherHeader.TotalDalamRupiah?.ToString("N2")"
                readonly style="font-size: 12px;"/>
        </div>
    </div>


   <div class="form-group row">
        <label class="col-sm-2 col-form-label">Keterangan Voucher</label>
        <div class="col-sm-10">
            <textarea class="form-control form-control-sm"
                    rows="4"
                    readonly
                    style="
                        font-size:12px;
                        background-color:#e9ecef;
                        border:1px solid #ced4da;
                        color:#495057;
                        resize:none;
                    ">@Model.VoucherHeader.KeteranganVoucher</textarea>
        </div>
    </div>


    <div class="form-group row">
        <label class="col-sm-2 col-form-label">Flag Posting</label>
        <div class="col-sm-4 d-flex align-items-center">
            <input type="checkbox"
                @(Model.VoucherHeader.FlagPosting ? "checked" : "") 
                disabled /> &nbsp; Posted
        </div>
    </div>
</fieldset>


    <hr/>


    <hr/>

    <script>

     function getNoVoucherFinalForDetailGrid() {
         return { noVoucher: $("#NoVoucherFinal").val() };
    }

     $(document).ready(function () {
        $("#FinalPaymentBankForm").hide();
        var ddl = $("#FlagPembayaran_Lihat").data("kendoDropDownList");

        // Daftarkan event change
       ddl.bind("change", function (e) {
            var value = this.value();
                if (value && value.toUpperCase() === "AKUN") {
                    $("#akunField_Lihat").show();
                    $("#notaField_Lihat").hide();
                    $(".detail-payment-field").show(); 
                } else if(value && value.toUpperCase() === "NOTA"){
                    $("#notaField_Lihat").show();
                    $("#akunField_Lihat").show();
                    $(".detail-payment-field").show();
                } else {
                    $("#notaField_Lihat").hide();
                    $("#akunField_Lihat").hide();
                    $(".detail-payment-field").hide();
                }
        });

        // Panggil event 'change' sekali saat form dimuat untuk mengatur tampilan awal
        ddl.trigger("change");
    });
    
    
    </script>

    @(Html.Kendo().Grid<EntriPembayaranBankDto>() // <-- Gunakan DTO yang benar
        .Name("DetailPembayaranLihatGrid")
        .DataSource(ds => ds.Ajax()
            .Read(read => read.Action("GetDetailPembayaran", "EntriPembayaranBank").Data("getNoVoucherFinalForDetailGrid"))
        )
        .Columns(cols => {
            cols.Bound(c => c.No).Width(80).Title("No.");
            cols.Bound(c => c.FlagPembayaran).Title("Flag Pembayaran").Width(150);
            cols.Bound(c => c.NoNota4).Title("No Nota").Width(150);
            cols.Bound(c => c.KodeAkun).Title("Kode Akun").Width(150);
            cols.Bound(c => c.KodeMataUang).Title("Kode Mata Uang").Width(150);
            cols.Bound(c => c.TotalBayar).Format("{0:n2}").Width(150).Title("Total Bayar");
            cols.Bound(c => c.TotalDlmRupiah).Format("{0:n2}").Width(180).Title("Total Dalam Rupiah");
            cols.Bound(c => c.DebetKredit).Title("D/K").Width(100);
           // cols.Command(command => {
          //  command.Custom("EditDetail").Text("Edit").Click("onEditFinalPembayaran");
     //   }).Title("Action").Width(180);
        })
        .NoRecords(nr => nr.Template("Belum ada pembayaran")).Pageable(pager => pager.Refresh(true))
                .Sortable()
                .Filterable()
                .Scrollable(s => s.Height(null)) 
                .Resizable(a=>a.Columns(true))
                .Events(ev => ev.DataBound("updateGridFooterLihat"))
    )
</div>


<div style="display: flex;gap: 15px;justify-content: flex-end;margin-right:20px">
    <button type="button" id="btn-cancel-edit" class="btn btn-secondary" style="display: none; margin-right: 10px;">Cancel</button>
    
</div>


<div class="window-footer" data-total-voucher-original-final="@(Model.VoucherHeader.TotalDalamRupiah ?? 0)" style=" font-weight: bold;    display: flex;     justify-content: center;     flex-direction: row;     flex-wrap: nowrap;     align-content: center;     align-items: center; ">
    <div style="padding-right: 20px;font-size: 13px;">
            <span>Total Voucher: </span>
            <span id="voucherTotal">@Model.VoucherHeader.TotalDalamRupiah?.ToString("N0")</span>
            
            <span style="margin-left: 20px;">Total Keseluruhan Pembayaran: </span>
            <span id="pembayaranTotalFinal" style="color: green;">0</span>

              <span style="margin-left: 20px;">Total Sisa Keseluruhan Pembayaran:  </span>
            <span id="sisapembayaranTotalFinal" style="color: green;">0</span>
        </div>
</div>



<style>
    /* Styling pesan no-records di grid */
    #DetailPembayaranLihatGrid .k-grid-norecords {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100px;   /* kasih ruang biar keliatan di tengah */
        font-size: 14px;
        color: #666;
        text-align: center;
    }
</style>