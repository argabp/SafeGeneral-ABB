@model ABB.Application.TemplateLapKeus.Queries.TemplateLapKeuDto
@using Kendo.Mvc.UI
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
@addTagHelper *, Kendo.Mvc

<style>
    .custom-kuning .k-input, .custom-kuning .k-textbox, .custom-kuning input { background-color: rgb(255, 255, 225) !important; }
    .window-body { padding: 10px; }
    .form-group { margin-bottom: 1rem; }
    .box-range { background-color: #f0f8ff; border: 1px solid #cce5ff; padding: 10px; border-radius: 5px; }
</style>

<div class="window-body">
    <form id="TemplateForm">
        @Html.HiddenFor(m => m.Id)
        @Html.HiddenFor(m => m.Rumus, new { id = "RumusFinal" }) 
        
        @Html.HiddenFor(m => m.TipeBaris)
        @Html.HiddenFor(m => m.Level)

        <fieldset>
            <div class="form-group row">
                <label class="col-sm-3 col-form-label">No. Urut</label>
                <div class="col-sm-3">
                    <kendo-numerictextbox name="Urutan" for="Urutan" min="0" format="n0" class="custom-kuning" style="width: 100%;" />
                </div>
                <div class="col-sm-4" style="display: flex; align-items: center;">
                    <input type="checkbox" id="chkLockUrutan" onchange="toggleUrutanLock()">
                    <label for="chkLockUrutan" style="margin-left: 5px; margin-bottom: 0; font-size: 12px; cursor:pointer;">Lock (Otomatis)</label>
                </div>
            </div>

            <div class="form-group row">
                <label class="col-sm-3 col-form-label">Tipe Laporan</label>
                <div class="col-sm-9">
                    <kendo-dropdownlist name="TipeLaporan" for="TipeLaporan" style="width: 100%;" class="custom-kuning"
                                        bind-to='new List<string>() { "NERACA", "LABARUGI", "ARUSKAS" }'
                                        on-change="onTipeLaporanChange"> </kendo-dropdownlist>
                </div>
            </div>

            <div class="form-group row">
                <label class="col-sm-3 col-form-label">Jenis Baris</label>
                <div class="col-sm-9">
                   @(Html.Kendo().DropDownList()
                        .Name("KategoriSelect") 
                        .DataTextField("Text")
                        .DataValueField("Value")
                        .BindTo(new List<dynamic>() {
                            new { Text = "JUDUL UTAMA (ASET, KEWAJIBAN)", Value = "HEADING-1" },
                            new { Text = "SUB JUDUL (Investasi, Lancar)", Value = "HEADING-2" },
                            new { Text = "DETAIL AKUN (1, 2, 3)", Value = "DETAIL-3" },
                            new { Text = "SUB DETAIL (a, b, c)", Value = "DETAIL-4" },
                            new { Text = "POIN DETAIL ( - )", Value = "DETAIL-5" }, // <--- TAMBAHAN BARU
                            new { Text = "SUB TOTAL (Jumlah Investasi)", Value = "TOTAL-2" },
                            new { Text = "GRAND TOTAL (JUMLAH ASET)", Value = "TOTAL-3" },
                            new { Text = "SPASI KOSONG", Value = "SPASI-1" }
                        })
                        .Events(e => e.Change("onKategoriChange"))
                        .HtmlAttributes(new { style = "width: 100%", @class="custom-kuning" })
                   )
                </div>
            </div>

            <div class="form-group row">
                <label class="col-sm-3 col-form-label">Deskripsi</label>
                <div class="col-sm-9">
                    <kendo-textbox name="Deskripsi" for="Deskripsi" class="custom-kuning" style="width: 100%;" placeholder="Contoh: ASET LANCAR" />
                </div>
            </div>
            
            <hr />

            <div class="form-group row" id="div-manual">
                <label class="col-sm-3 col-form-label">Kode Akun</label>
                <div class="col-sm-9">
                     <kendo-textarea name="RumusManual" rows="3" class="custom-kuning" style="width: 100%;" placeholder="Contoh: 1101,1102">
                    </kendo-textarea>
                    <small class="text-muted" id="rumus-hint">* Masukkan Kode Akun dipisah koma.</small>
                </div>
            </div>

            <div class="form-group row" id="div-range" style="display:none;">
                <label class="col-sm-3 col-form-label">Hitung Total</label>
                <div class="col-sm-9">
                    <div class="box-range">
                        <div class="row">
                            <div class="col-md-6">
                                <label>Dari Baris</label>
                                @* FITUR SEARCHABLE: .Filter(FilterType.Contains) *@
                                <kendo-dropdownlist name="StartRow" style="width: 100%;" 
                                                    datatextfield="Text" datavaluefield="Value" 
                                                    option-label="-- Cari/Pilih Awal --"
                                                    filter="FilterType.Contains"> 
                                    <datasource><transport><read url="/TemplateLapKeu/GetTemplateOptions" data="getTemplateParam" /></transport></datasource>
                                </kendo-dropdownlist>
                            </div>
                            <div class="col-md-6">
                                <label>Sampai Baris</label>
                                @* FITUR SEARCHABLE: .Filter(FilterType.Contains) *@
                                <kendo-dropdownlist name="EndRow" style="width: 100%;" 
                                                    datatextfield="Text" datavaluefield="Value" 
                                                    option-label="-- Cari/Pilih Akhir --"
                                                    filter="FilterType.Contains">
                                    <datasource><transport><read url="/TemplateLapKeu/GetTemplateOptions" data="getTemplateParam" /></transport></datasource>
                                </kendo-dropdownlist>
                            </div>
                        </div>
                        <small class="text-muted mt-2 d-block">* Sistem akan menjumlahkan angka dari baris Awal s/d Akhir.</small>
                    </div>
                    
                    <div style="margin-top:10px;">
                        <input type="checkbox" id="chkManualTotal" onchange="toggleManualTotal()"> 
                        <label for="chkManualTotal" style="font-size:11px;">Input Manual (Untuk Grand Total Acak)</label>
                    </div>
                </div>
            </div>

            <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px; border-top: 1px solid #eee; padding-top: 10px;">
                <button type="button" class="btn btn-secondary" onclick="closeWindow()">Batal</button>
                <button type="button" class="btn btn-primary" onclick="saveTemplate()">
                    <i class="fa fa-save"></i> Simpan
                </button>
            </div>
        </fieldset>
    </form>
</div>